# AWS 네트워크 & VPC 기초 개념

&nbsp;

# 1. 들어가며

AWS를 국비 부트캠프를 들을 때도, 인턴을 할 때도 사용을 했지만 제대로 알고 사용한다는 느낌을 받지는 못 했습니다. 누군가 설정한대로 똑같이 보고 따라하다보니 각각의 설정이 의미하는 바가 뭔지, 왜 그렇게 설정을 해야되는지에 대한 이해가 부족했습니다.

백엔드 개발자로서 데브옵스만큼 인프라를 잘 다루는 것은 힘들지라도 최소한 기본은 알아야 향후 내가 새로운 인프라를 설정할 때나 다른 사람이 만든 인프라를 사용할 때 애로사항이 없겠다 싶어 AWS 공부를 해야겠다고 생각을 했습니다.

특히 AWS를 다룰 때 거의 모든 자원에 필수적으로 연관되는 VPC에 대해서 공부를 해야될 것 같았습니다. VPC는 일종의 네트워크이기 때문에 네트워크 개념이 없는 저로서는 이해하는 것이 무척 어려웠기 때문입니다. 

이하에서는 제가 인프런의 [CloudNet@와 함께하는 AWS 네트워킹 입문](https://www.inflearn.com/course/cloudneta-aws-%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%82%B9-%EC%9E%85%EB%AC%B8/dashboard) 강의를 들으며 배운 네트워크 및 VPC 관련 개념에 대해 정리해보고자 합니다.



&nbsp;

# 2. 네트워크 기본 개념

#### 2.1 IP 주소

네트워킹 환경에서 IT 자원을 식별하는 3계층의 고유한 주소입니다. 현재 버전을 두 개 사용하고 있습니다.

- IPv4: 32비트 
- IPv6: 128비트

현재 대중적으로는 IPv4를 더 많이 사용하고 있습니다.



IP 주소에 대해서 좀 더 자세히 알아보면 다음과 같습니다. 우선 다음과 같은 IP주소가 있다고 가정을 해보겠습니다. 

`11000000.10100011.01100100.00000001`

8자리 2진수가 총 4파트로 있으니 32비트이고 이를 통해 IPv4 방식이라는 것을 알 수 있습니다. 제가 4파트로 있다고 설명을 했는데 여기서 각 파트를 **옥텟** 이라고 부릅니다. 그리고 이렇게 2진수로 IP 주소가 있으면 읽기가 힘드니 10진수로 바꿔서 많이 사용합니다. `192.168.100.1` 이런 식입니다.



IP주소는 통신 용도에 따라 두 가지로 나눌 수가 있습니다.

- 퍼블릭 IP 주소: 인터넷 구간에서 사용하는 유일한 공인 IP 주소
- 프라이빗 IP 주소: 독립된 네트워 내에서만 사용하는 내부 사설 IP 주소



&nbsp;

#### 2.2 서브넷과 서브넷 마스크

**서브넷**이란 네트워크를 분리하는 부분 네트워크입니다. 그림으로 보면 이렇게 될 수 있겠네요.

<img src="https://github.com/hyunzxn/TIL/assets/100478841/711b6fee-6f56-4e5c-9bdc-c162695bf559" alt="IMG_0147" width="300"/>



&nbsp;

이렇게 생성된 각 서브넷을 식별하기 위해서 **서브넷 마스크**를 사용합니다. 예시를 보면서 설명을 보충하겠습니다.

서브넷 a: `192.168.100.1/24`

서브넷 b: `192.168.100.1/24`

서브넷 c: `192.168.200.1/24`

결론부터 말씀드리면 서브넷 a와 서브넷 b는 같은 네트워크에 있는 서브넷이고 서브넷 c는 다른 네트워크에 있는 서브넷입니다. 이것을 이해하려면 네트워크 아이디와 호스트 아이디, 그리고 IP CIDR에 대해 알아야 합니다.

&nbsp;

> **네트워크 아이디와 호스트 아이디**
>
> 서브넷 마스크는 네트워크 아이디와 호스트 아이디로 구분이 됩니다. 네트워크 아이디와 호스트 아이디는 **IP CIDR**에 의해서 결정이 되는데요. 예시에서 IP 주소 뒤에 있는 **/24** 부분이 IP CIDR입니다. 여기서 24는 비트 수를 의미합니다. 즉 IP 주소에서 24비트까지는 네트워크 아이디로 하고 그 뒤에 나머지 8비트는 호스트 아이디로 하겠다는 의미입니다. 
>
> 같은 네트워크인지 여부를 결정하는 것은 네트워크 아이디이고 서브넷을 식별하는 것은 호스트 아이디입니다. 예시로 돌아가보면 서브넷 a는 IP CIDR가 /24 이므로 서브넷 a와 서브넷 b가 같은 네트워크 아이디이기 때문에 같은 네트워크에 소속돼 있는 것이고 서브넷 c만 다른 네트워크에 소속돼 있다고 식별할 수 있는 것입니다.

&nbsp;

앞서 서브넷은 네트워크의 부분이 되는 네트워크라고 말씀을 드렸는데요. 따라서 서브넷은 항상 자신이 소속돼 있는 네트워크의 네트워크 아이디를 그대로 사용하게 됩니다. 사실 이건 너무 당연한 것입니다. 큰 네트워크의 부분 네트워크가 다른 네트워크 아이디를 사용한다는 것은 논리적으로 말이 안 되기 때문입니다.

&nbsp;

#### 라우팅과 라우터

라우팅은 네트워크 통신을 수행할 때 최적의 목적지 경로를 선택하는 작업을 의미합니다. 그리고 이것을 수행하게 하는 장비를 라우터라고 합니다.

&nbsp;

# 3. AWS VPC

이제부터는 AWS의 VPC의 개념을 소개하고 관련된 서비스에 대해서 정리해보고자 합니다.

&nbsp;

#### 3.1 VPC

AWS에서 제공하는 가상 프라이빗 네트워크 서비스입니다. AWS에서 어떤 자원을 설정하려고 할 때 VPC 설정하는 부분이 꼭 등장할만큼 VPC는 AWS에서 빼놓을 수 없는 개념입니다. VPC를 만들고 그 안에 여러 가상 IT 자원들을 설치할 수 있습니다.

&nbsp;

#### 3.2 인터넷 게이트웨이

서브넷을 만들 때는 퍼블릭 또는 프라이빗으로 만들 수 있는데요. 퍼블릭으로 만든 서브넷의 경우 외부 인터넷과 통신을 주고 받기 위해서는 인터넷 게이트웨이를 거쳐야 합니다. 뒤에서 설명할 라우팅 테이블에 인터넷 게이트웨이의 주소를 넣어놓음으로써 퍼블릭 서브넷 -> 외부 인터넷 방향으로 통신을 할 수 있습니다.

인터넷 게이트웨이는 퍼블릭 서브넷 안에 설치합니다.

&nbsp;

#### 3.3 NAT 게이트웨이

인터넷 게이트웨이가  퍼블릭 서브넷의 외부 인터넷과의 통신을 위한 자원이라면 NAT 게이트웨이는 프라이빗 서브넷이 외부 인터넷과 통신할 때 사용하는 자원입니다. NAT의 의미는 Network Address Translate의 약자입니다. NAT 게이트웨이에서 퍼블릭 IP로 주소를 변환해서 통신을 하기 때문에 이런 이름을 가지고 있습니다. 

원칙적으로 프라이빗 서브넷은 외부 -> 프라이빗 서브넷 방향의 통신이 불가능한데요. 프라이빗 서브넷 -> 외부 인터넷 방향으로 통신을 할 때가 있습니다. 그럴 때 사용하는 것이 NAT 게이트웨이입니다. 

NAT 게이트웨이의 설치 위치는 프라이빗 서브넷이라고 생각하기 쉽지만 그렇지 않습니다. NAT 게이트웨이의 설치 위치는 퍼블릭 서브넷입니다. 프라이빗 서브넷의 라우팅 테이블에 	NAT 게이트웨이를 넣어두고 외부와 통신할 일이 있을 때 트래픽을 NAT 게이트웨이로 라우팅을 하면 프라이빗 IP가 퍼블릭 IP로 변환되고 퍼블릭 서브넷에 설치한 인터넷 게이트웨이를 거쳐 외부와 통신할 수 있게 되는 구조입니다.

&nbsp;

#### 3.4 네트워크 ACL & 보안그룹

네트워크 ACL과 보안그룹은 모두 보안과 관련된 AWS 자원입니다. 각각은 비슷한듯 하면서도 조금씩 다른 특성을 가지고 있습니다.

**네트워크 ACL**

서브넷 자체를 보호하는 역할을 합니다. stateless 특성을 가지고 있어서 인바운드 규칙으로 허용해준 트래픽도 아웃바운드 규칙에서 허용해줘야만 통신이 이뤄지는 특성입니다.



**보안그룹**

보안그룹은 서브넷 안에 있는 자원을 보호하는 역할을 합니다. stateful한 특성을 가지고 있어서 인바운드 규칙에서 허용된 트래픽이라면 아웃바운드 규칙에서 별도로 허용을 해주지 않아도 통신이 가능합니다.

&nbsp;

네트워크 ACL과 보안그룹에 대해서는 다른 글에서 조금 더 자세하게 설명해보도록 하겠습니다.

&nbsp;

# 4. 마치며

네트워크 기초와 VPC를 사용하게 되면 자주 등장하는 개념에 대해서 정말 간단하게 정리해봤습니다. 이런 기초를 알고 나니 이제 왜 그렇게 설정을 했던 것이고 이런게 어떤 의미가 있는 것이구나 하는 이해가 잘 되었던 것 같습니다. 

물론 이 정도는 정말 기초 중의 기초라서 더 심화 개념 등을 많이 알아야겠지만 정말 초보 분들이라면 이 정도만 알아도 초급 수준의 실습 혹은 설정에서는 따라갈 수 있을 것이라 생각합니다.





