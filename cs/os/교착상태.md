# 교착상태

&nbsp;

# 1. 들어가며

흔히 데드락이라고 불리는 교착 상태에 대해서 정리해보고자 합니다. 교착 상태를 제대로 해결하지 못 하면 프로세스가 정상적으로 실행되지 못 하므로 교착 상태에 대해서 제대로 이해하는 것이 중요할 것 같습니다.

&nbsp;

# 2. 교착 상태란 무엇인가?

교착상태란 프로세스들이 서로가 점거하고 있는 자원을 기다리며 결국에는 어떤 프로세스도 정상적으로 실행이 되지 않는 상황을 의미합니다.

<img width="850" alt="도식1" src="https://github.com/hyunzxn/TIL/assets/100478841/cb2a17b9-9689-40c1-ac06-bda8f3917081">

그렇다면 이걸 해결할 수 있는 방법은 무엇일까요? 두 가지 스텝이 있습니다.

1. 교착 상태가 발생했을 때의 상황을 정확히 표현해보기
2. 교착 상태 발생 근본적 이유 파악

&nbsp;

첫번째 스텝인 교착 상태가 발생했을 때의 상황을 정확히 표현하기 위한 수단으로 **자원할당 그래프**라는 것이 있습니다. 자원할당 그래프를 통해서 교착 상태 발생 조건을 파악할 수 있는데요. 교착상태 발생 조건이란 어떤 프로세스가 어떤 자원을 할당받아 사용 중인지 혹은 어떤 자원을 기다리고 있는지 등의 정보를 의미합니다.

자원할당 그래프를 그리는 방법은 어렵지 않습니다.

1. 프로세스는 원으로 표현하고 자원은 사각형으로 표현합니다.
2. 자원의 개수는 사각형 안에 있는 점의 개수로 표현합니다.
3. 자원에서 프로세스 쪽으로의 화살표는 자원의 할당을 의미하고, 프로세스 쪽에서 자원 쪽으로의 화살표는 자원의 대기를 의미합니다.

예시를 보면 이해가 쉽게 되실 겁니다.

<img width="900" alt="도식2" src="https://github.com/hyunzxn/TIL/assets/100478841/c8a70ae2-3af8-4c6b-9466-d664f9645c12">

자원할당 그래프를 보면 어떤 그래프가 교착 상태가 발생한 것을 나타내는지 쉽게 확인할 수 있습니다. 바로 **원형**을 띄고 있는 자원할당 그래프는 교착 상태를 표현하고 있는 것입니다. 예시에서 보인 자원할당 그래프도 프로세스 A와 프로세스 B가 원형을 띄고 있는 것을 볼 수 있는데요, 이런 경우를 교착 상태라고 하는 것입니다.

&nbsp;

그렇다면 교착 상태 발생의 근본적인 이유는 무엇이 있을까요? 교착 상태 발생의 조건으로는 4가지가 있습니다.

1. 상호배제: 한 프로세스가 사용하는 자원을 다른 프로세스가 사용할 수 없는 상태 → 프로세스 동기화 공부할 때 등장한 개념!
2. 점유와 대기: 자원을 이미 할당받은 상태에서 다른 자원을 할당 받기를 기다리는 상태
3. 비선점: 어떤 프로세스도 다른 프로세스의 자원을 강제로 빼앗지 못 하는 상태
4. 원형대기: 프로세스들이 원형으로 자원을 대기하는 상태 

4가지 조건이 모두 존재하는 경우에 교착상태가 **발생할 수도** 있습니다. 즉 무조건 발생하는 것은 아니라는 의미입니다. 하지만 만약 4가지 조건 중 하나라도 존재하지 않는다면 교착 상태는 발생하지 않습니다.

&nbsp;

지금까지 교착 상태는 무엇이고 발생 조건은 무엇인지에 대해서 살펴봤습니다. 이제는 이것을 어떻게 해결하는지를 정리해보도록 하겠습니다.

&nbsp;

# 3. 교착 상태 해결

교착 상태를 해결하는 방법에는 3가지가 있습니다.

1. 예방
2. 회피
3. 검출 후 회복

이제 각각에 대해서 자세하게 알아보도록 하겠습니다.

&nbsp;

**예방**

예방은 이름에서 알 수 있듯이 애초에 교착 상태가 발생하지 않도록 하는 것을 의미합니다. 앞서 교착 상태를 발생시키는 4가지 조건이 있다고 하였는데요, 예방은 이 4가지 조건 중 하나를 없애 버림으로써 교착 상태가 일어나지 않도록 하는 것을 의미합니다.

➀ 상호배제 없애기: 이것은 부작용이 많기 때문에 현실적으로 잘 추천하지 않는 방법입니다.

➁ 점유와 대기 없애기: 특정 프로세스에 자원을 모두 할당하거나 아예 할당하지 않는 방식으로 자원을 배분하는 것을 의미합니다. 자원의 활용도가 너무 떨어져서 비효율적으로 자원을 사용하게 된다는 한계가 있습니다.

➂ 비선점 없애기: 선점이 가능한 자원(ex. CPU)에 대해서는 효과적이지만 모든 자원이 선점 가능한 것이 아니기 때문에 실용적이지 않습니다.

➃ 원형 대기 없애기: 자원에 번호를 매기고 오름차순으로 자원을 할당하게 되면 원형대기 문제가 발생하지 않습니다. 그러나 자원에 번호 매기기가 어려울 뿐더러 어떤 자원에 어떤 번호를 붙이는지에 따라 자원의 활용도가 달라진다는 한계가 있습니다.



교착 상태 예방은 교착 상태를 확실히 예방할 수 있다는 장점은 있지만 각각의 방법이 한계가 명확합니다.

&nbsp;

**회피**

회피는 교착 상태 발생의 원인으로 무분별한 자원 할당을 꼽습니다. 따라서 자원 할당을 효율적으로 잘 하면 교착 상태가 발생하지 않을 것이라는 관점으로 접근합니다. 

회피에 대해서 알기 위해서는 3가지 개념을 알아야 합니다.

➀ 안전순서열: 교착 상태 없이 모든 프로세스들에게 안전하게 자원을 할당할 수 있는 순서

➁ 안전상태: 교착 상태 없이 모든 프로세스가 자원을 할당받고 종료될 수 있는 상태 → 안전순서열이 있는 상태

➂ 불안전상태: 교착 상태가 발생할 수도 있는 상태 → 안전순서열이 없는 상태

즉 회피 방법은 항상 안전상태를 유지하도록 자원을 할당하는 방식이라고 정리할 수 있습니다. 

&nbsp;

**검출 후 회복**

검출 후 회복은 교착 상태 발생을 인정하고 사후에 조치하는 방식입니다. 일단 프로세스가 자원을 요구하는대로 할당을 하고 교착 상태가 발생하면 그 때 회복을 시키게 됩니다.

검출 후 회복은 2가지 방법으로 이뤄질 수 있습니다.

➀ 선점을 통한 회복: 교착 상태가 해결될 때까지 한 프로세스씩 자원을 몰아주는 방법입니다.

➁ 프로세스 강제 종료

1) 교착 상태에 놓인 프로세스를 모두 강제 종료: 작업 내역 손실의 위험 존재

2) 해결될 때까지 프로세스를 하나씩 강제 종료: 오버헤드 위험 존재

&nbsp;

# 4. 마치며

교착 상태의 해결 방법으로 교착 상태를 그냥 무시하는 방법도 하나 있다고 합니다. 물론 완벽한 애플리케이션을 위해서라면 이런 방법은 권장되지 않겠지만, 현실적으로 지금 당장 처리해야할 다른 문제가 더 시급하고 교착 상태로 인한 문제가 중대하지 않다면 이런 방법도 기술적인 허용을 해주는 방법도 있다고 합니다. 하지만 제일 좋은건 교착 상태가 일어나지 않도록 잘 예방하고 발생 시 유연하게 잘 대처하는 것 같습니다.



