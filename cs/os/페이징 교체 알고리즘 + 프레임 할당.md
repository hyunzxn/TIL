# 페이지 교체 알고리즘 + 프레임 할당

&nbsp;

# 1. 들어가며

이번 글에서는 [지난 번 글에서 정리한 글](https://github.com/hyunzxn/TIL/blob/main/cs/os/%EA%B0%80%EC%83%81%EB%A9%94%EB%AA%A8%EB%A6%AC_%ED%8E%98%EC%9D%B4%EC%A7%95.md)에 이어서 페이지를 교체할 때는 어떤 알고리즘을 사용하고 프로세스에 프레임을 어떻게 할당할 지를 정하는 프레임 할당 방식에 대해서 정리를 해보겠습니다.

&nbsp;

# 2. 페이지 교체 알고리즘

**요구 페이징**

페이징 교체 알고리즘을 정리하기에 앞서 한 가지 알아야 할 개념이 있습니다. 바로 **요구 페이징**이라는 개념입니다.

요구 페이징은 요구되는 페이지만 메모리에 적재하는 기법을 의미합니다. 불필요한 페이지를 제외하고 딱 필요한 페이지만 메로리에 적재함으로써 메모리 낭비를 줄이려는 시도입니다. 이런 요구 페이징을 안정적으로 작동하게 하기 위해 해결해야 할 문제가 2가지 있는데요. 그것이 바로 **페이지 교체**과 **프레임 할당**입니다. 이제 본격적으로 페이지 교체 알고리즘과 프레임 할당에 대해서 정리해도보록 하겠습니다.

&nbsp;

**페이지 교체 알고리즘**

페이지 교체 알고리즘이란 무엇일까요? 요구 페이징 기법으로 페이지를 계속해서 메모리에 적재하다보면 물리 메모리의 특성 상 언젠가는 메모리가 가득차게 될 것입니다. 당장 지금 실행해야 할 페이지가 있는데 메모리가 가득 차서 적재하지 못 한다면 문제가 발생하게 될 것입니다. 이럴 때 이미 메모리에 적재된 페이지 중 어떤 것을 보조기억장치로 내보낼 것인지를 결정하는 알고리즘을 페이지 교체 알고리즘이라고 합니다.

앞으로 몇 가지 페이지 교체 알고리즘을 소개할 예정인데요, 그렇다면 좋은 알고리즘은 무엇일까요? 페이지 교체 알고리즘에서의 좋은 알고리즘을 결정하는 기준은 페이지 폴트가 얼마나 적게 발생하는 지로 판단할 수 있습니다. 

&nbsp;

## 2.1 FIFO 페이지 교체 알고리즘

이름에서 알 수 있듯이 메모리에 먼저 올라온 페이지부터 내보내는 방식을 의미합니다. 그렇지만 이 방식은 별로 권장되지 않습니다. 초기에 메모리에 적재됐다고 하더라도 프로그램 실행 내내 사용될 페이지를 먼저 내보내는 것은 비합리적이기 때문입니다.

## 2.2 최적 페이지 교체 알고리즘

앞으로 사용할 빈도가 가장 낮은 페이지를 예측해서 내보내는 알고리즘을 의미합니다. 가장 낮은 페이지 폴트율을 보장한다는 장점이 있습니다. 그러나 앞으로 어떤 페이지가 사용할 빈도가 낮을 지를 예측하는 것이 어렵기 때문에 구현하는 것이 어렵습니다. 

## 2.3 LRU 페이지 교체 알고리즘

LRU는 **Least-Recently-Used**의 약자입니다. 최적 페이지 교체 알고리즘을 반대로 뒤집은 알고리즘이라고 생각하면 됩니다. 미래에 가장 적게 사용될 페이지를 예측하는 것은 어렵지만 최근까지 가장 오랫동안 사용되지 않은 페이지를 파악하는 것은 상대적으로 쉽기 때문에 이 방식을 많이 사용합니다.

&nbsp;

페이지 교체 알고리즘에서 좋은 알고리즘이란 페이지 폴트가 적게 발생하는 알고리즘이라고 언급했는데요. 그렇다면 페이지 폴트는 왜 발생하는 것일까요? 두 가지 이유를 생각해 볼 수 있을 것 같습니다.

1. 프로세스가 사용할 수 있는 프레임 자체가 적기 때문이다.
2. 나쁜 페이지 교체 알고리즘을 사용하기 때문이다.

이 중에서 1번이 페이지 폴트가 발생하는 좀 더 근본적인 이유에 가깝습니다. 여기서 알 수 있는 것은 페이지 교체와 프레임은 밀접한 관련이 있다는 것입니다. 이제 두번째 주제인 프레임 할당에 대해서 정리해보도록 하겠습니다.

&nbsp;

# 3. 프레임 할당

프레임 할당에 대해서 살펴보기에 앞서 소개할 개념이 있습니다. **스래싱**이라는 것입니다. 

스래싱이란 프로세스가 실행되는 시간보다 페이징에 더 많은 시간을 소요하여 CPU 이용률과 같은 성능이 저하되는 문제를 의미합니다. 스래싱이 발생하는 이유는 각 프로세스가 필요로 하는 최소한의 프레임 수가 보장되지 않기 때문입니다. 따라서 각 프로세스가 필요로 하는 최소한의 프레임 수를 파악하고 적절하게 프레임을 할당하는 작업이 필요합니다. 프레임을 할당하는 방식에는 4가지가 있습니다.

1. 정적 할당 방식: 프로세스 크기를 판단 기준으로 프레임을 할당하는 방식
   - 균등 할당
   - 비례 할당
2. 동적 할당 방식: 프로세스가 실행되는 과정을 기준으로 프레임을 할당하는 방식
   - 작업 집합 모델
   - 페이지 폴트 빈도 기반 할당

이제 각각에 대해서 알아보도록 하겠습니다.

&nbsp;

## 3.1 균등 할당

모든 프로세스에게 프레임을 똑같이 할당하는 방식으로 가장 간단한 방식입니다. 그렇지만 그렇게 추천되는 방식은 아닙니다. 프로세스의 크기가 다 다른데 굳이 똑같은 크기의 프레임을 할당할 이유가 없기 때문입니다.

## 3.2 비례 할당

프로세스의 크기에 비례해서 프레임을 배분하는 방식입니다. 그러나 실제로 필요한 프레임은 실행을 해 봐야 알 수 있는 것이 일반적입니다. 가령 프로세스 크기는 작아도 필요한 프레임은 많은 프로세스가 있을 수 있고, 프로세스 크기는 엄청 큰 데 실제 필요로 하는 프레임은 적을 수 있습니다. 

이렇게 프로세스 실행 과정에서 필요한 프레임 수를 파악하여 결정하는 동적 할당 방식이 위에서 언급한 2가지 방식입니다.

## 3.3 작업 집합 모델

작업 집합 모델이란 CPU가 특정 시간동안 주로 참조한 페이지 개수만큼만 프레임을 할당하는 방식입니다. 작업 집합이란 실행 중인 프로세스가 일정 시간 동안 참조한 페이지의 집합을 의미합니다. 

## 3.4 페이지 폴트 빈도 기반

페이지 폴트 빈도를 기반으로 프레임을 할당하는 방식은 두 가지 가정에서 비롯됐습니다.

1. 페이지 폴트율이 너무 높다는 것은 프로세스가 너무 적은 프레임을 가지고 있다는 것이다.
2. 페이지 폴트율이 너무 낮다는 것은 프로세스가 너무 많은 프레임을 가지고 있다는 것이다.

이걸 극복하기 위해서 페이지 폴트 빈도 기반 할당 방식에서는 **페이지 폴트율 상한선과 하한선**을 설정합니다. 페이지 폴트율 상한선보다 높다는 것은 프레임이 너무 적게 할당됐다는 뜻이고, 반대로 페이지 폴트율이 하한선보다 낮다는 것은 프레임이 너무 많이 할당됐다는 뜻으로 해석합니다. 그래서 페이지 폴트율이 하한선과 상한선 사이에서 유지되도록 프레임을 할당하는 것이 페이지 폴트 빈도 기반 할당 방식입니다.

&nbsp;

# 4. 마치며

지난 번 글에 이어 이번 글까지 페이징에 대해서 알아보았습니다. 페이징이 그만큼 운영체제에서 중요한 개념인 것 같습니다. 확실하게 정리를 잘 해둬야 할 것 같습니다.